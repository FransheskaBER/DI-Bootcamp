<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <h1>Register:</h1>
    <form id="myform">
        <label>First Name <input type="text" name="first_name" value="" placeholder="e.g., John"></label><br><br>
        <label>Last Name <input type="text" name="last_name" value="" placeholder="e.g., Doe"></label><br><br>
        <label>Email <input type="text" name="email" value="" placeholder="e.g., johndoe@example.com"></label><br><br>
        <label>Username <input type="text" name="username" value="" placeholder="e.g., johnny"></label><br><br>
        <label>Password <input type="text" name="password" value="" placeholder="e.g., secret123"></label><br><br>
        <button type="submit">Register</button>
    </form>

    <div id="section">
        <p id="feedback"></p>
    </div>
    <script defer>

        // DOMS
        const myform = document.getElementById("myform");
        const feedback = document.getElementById("feedback");
        const section = document.getElementById("section");

        myform.addEventListener("submit", async (e) => {
            e.preventDefault();

            const formdata = new FormData(myform);
            const body = {
                first_name: formdata.get("first_name"),
                last_name: formdata.get("last_name"),
                email: formdata.get("email"),
                username: formdata.get("username"),
                password: formdata.get("password")
            };

            try {
                const res = await fetch("/users/register", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(body),
                });
                const data = await res.json();

                if (!res.ok) {
                    feedback.textContent = data.error || "Account is already in used.";
                    const link = document.createElement("a");
                    link.href = "http://localhost:7700/login.html";
                    link.textContent = "Got to Login Page."
                    section.appendChild(link);
                    return;
                }
                feedback.textContent = data.message;
            } catch(err){
                feedback.textContent =  "Network error, please try again later.";
            }

            myform.reset();
        });


    </script>
</body>
</html>